dist: xenial
language: python
python:
- '2.7'
jdk:
- oraclejdk7
addons:
  postgresql: '9.6'
install:
- pip uninstall --yes psqlgraph || true
- pip install pipenv
- pipenv install --dev --deploy --python `which python`
- pipenv graph
before_script:
- echo $JAVA_OPTS
- export JAVA_OPTS=-Xmx512m
- echo -e 'Host github.com\n\tStrictHostKeyChecking no\n' >> ~/.ssh/config
- pipenv run python test/setup_test_psqlgraph.py
script: pipenv run py.test -v test
before_deploy:
- sed -i.bak "s/=get_version()/='$TRAVIS_TAG'/g" setup.py
- cat setup.py
- if [ $(python setup.py --version) == '0.0.0' ]; then travis_terminate 1; fi
deploy:
  provider: pypi
  user: uc-ctds
  skip_existing: true
  skip_cleanup: true
  on:
    python: 2.7
    repo: uc-cdis/psqlgraph
    tags: true
    branch: develop
  password:
    secure: Jkr/X+50lKMdKTujPvjK3mgpyBxFXuKTMLPUXNN5w+OrjcDlvAFWOis0ngxBInoZ9eLXgAp1KfpXviXJ0w8q9Q8DL8WO4uzli0y/+WKdX9sMux7llgefc8GNlRElIC4hI9wKloODBUE+hNeck2FSMNdHMJLvonuLoR5jfWtDsaPod22tLqQya8JBrwGA0mN+2Mgn4IN+j38/lYpN9yr4yAIAhzgXfyGnF2pu+0ziPQRraI2bAfB3eD3Lu6sXb4I/1OSnSYNqOaZ+v5Jhb5urp+m4p+07P/xYfIyya19cGYt7e/MC6zQOcGnSgv7xsP6h5kG4gsvOZ5N1ZembbxVy60cJ+8EfQq+NgIWEtPAOw34lUsGeewM9hZqhej79Z6PYxbffLaeqyIPKUQ7RVe9IG5k42/zdi9x5Rk8FLsfSEOWXxC3xzMPDd7VarLVCMcO15teeKTxChods9EKbi4oIK9ImPgne1eisQHGUamSuWC9mIgs+DyskApIN8ppRZXbTa2S8hJ+/3ek9yKn1ec7q9HsuRj3mTTz+2jZypaXWcX4O6F6DEOzYDRL5+0noGEJD7o13xrV99/9FsaLHCc2EwutsqnOZGdDUYL542DprYFXEu0ByfypSIMOeMfe7UYssMBZFHBEw/Q4XGNf01Qrsghvx7xkDltHmUSGpZObWXWE=
env:
  global:
  - PIPENV_IGNORE_VIRTUALENVS=1
  - secure: OADcVWEZgkVtRduIDbuyXBVBoEeJJCJZ/yGqLK+uU4ziM+CJ7AxEHbOgKENpkbUXEvrTz1CnNt//CAKGXZnPU0mBLvCB0sD1WvO3ITNcufqxUBceEAyrrjMEwrQ51fHTSzWxfaHYcqFGsxHonHOsS/hLuRshgGgc8HT5Yu39WBtiTG6SCvKAsq7GYuk4PQ6vK44g5YVZqzur9zyXcUdFmv+GBBHVfXlTGwzd9CMfx+o0sqpD9KcAxMCIfoxL/ReGM3KihFy+WgID9gmlH6tq18RnKrtLZbHgPO5395HPZoKpy+HWJtCOf1Q/luvCPo+DI4LYhU9o/WOOSPK4hb06IUOMYlxDf0LKo3P85P2lGhM3RLpiKF6+YB+EjLdld1LCFHPMRi3QG6pUAH6Jg3+9Iko3ry2QCNFMGxOmfdc8vYefXanSi7++MxevKONQdAb2rcz+XK/5bLXWWzPbs4QC0y+c6GzcayQwHDrlrf5kvHBC27zy/kW8oW7iQlN+4UgddZeUBjiSm7bdWNt2D1r522vMz6W+9JU3dNLcHoBiNm3dJVFbOV3RX4RaJdNnUUX9FMeS4xpBV1/keR2d3wZxFQjf4/uQq6/crOtBExtxwaZSPt+R0/JRCtQcQYxU9uum2ezVmFhjzFkKgsW3dDVQFja9Hxp1bc0G/tBs2vfhlUc=
# gen3git release will try to pull old commits instead of just commits since last tag.
# Need to fix this (PXP-3383), then can uncomment after_deploy section
# For now just manually generate release notes.
#after_deploy:
#- pipenv run pip install gen3git
#- pipenv run gen3git release
